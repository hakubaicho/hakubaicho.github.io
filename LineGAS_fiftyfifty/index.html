<!DOCTYPE html>
<html lang="ja">

<head>
  <!-- 
    スライドショー
    -ゆっくりズームアウトさせながら全画面で見せる-
    https://coco-factory.jp/ugokuweb/move01/6-1-3/ 
  -->
  <meta charset="utf-8">
  <title>スライドショー</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="stylesheet" href="css/styles.css" />
  <!--自作のJS-->
  <script src="js/main.js"></script>
</head>

<body>
  <p id="status-of-api">未取得</p>
  <input type="button" value="低速" onclick="reload_image()" />
  <!-- サイネージコンテナ -->
  <div class="signage-container">
    <!-- 画像スライドショーコンテナ -->
    <div class="slideshow-container">
      <img src="img/halloween_card00.jpg" id="pics">
      <button id="playButton" onclick="playSlidedeshow();">PLAY</button>
    </div>
    <!-- テロップコンテナ -->
    <div class="terop-container">
      <p>ごちゃごちゃっと</p>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script>
      // APIのURL
    const endpoint = "https://script.google.com/macros/s/AKfycbyarYp4dlnCKKilnOJ1wLwCE6XuftXD9M89fvMxAdQ3QdFqoz7P5G8HiZJr1Yfb4eJFeA/exec";
    function inputToGoogleAPI() {
      document.getElementById('status-of-api').textContent = "データ取得中";
      $.ajax({
        type: 'GET',
        url: endpoint,
        dataType: 'jsonp',
        // dataType: 'json',
        data: {
          text: 'Hi,There!'
          // text: inputvalue
        }
      })
        .done(function (out) {
          const terops = out.terop;
          const images = out.image;

          reloadPicture(images);
          // データ取得の結果
          let todayDate = new Date();
          let strDate = "";
          strDate += `${todayDate.getFullYear()}/${todayDate.getMonth() + 1}/${todayDate.getDay()}`;
          strDate += " ";
          strDate += `${todayDate.getHours()}:${todayDate.getMinutes()}:${todayDate.getMinutes()}`;
          document.getElementById('status-of-api').textContent = `データ取得完了:${strDate}`;
        })
        .fail(function (err) {
          document.getElementById('status-of-api').textContent = `エラーが起きました:${err}`;
          // alert("エラーが起きました");
        })
        .always(function () {
          console.log("Ajax処理終了");
        });
    }

    window.onload = () => {
      inputToGoogleAPI();
    };
    const countUp = () => {
      inputToGoogleAPI();
      // console.log(count++);
      // document.getElementById('status-of-counter').textContent = count;
    }
    setInterval(countUp, 60000);
  </script>
</body>

</html>