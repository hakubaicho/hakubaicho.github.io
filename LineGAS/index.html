<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width-device-width, initial-scale=1.0">
    <title>Lineに投稿すると反映する</title>
    <style>
        .font-large {
            font-size: 3vw;
        }
    </style>
</head>

<body>

    <div>
        <p>Lineに投稿すると反映する</p>
        <p hidden id="status-of-counter">-</p>
        <button onclick="inputToGoogleAPI()">データの取得</button>
        <button onclick="getImage()">画像の取得</button>
    </div>
    <div class="font-large">
        <p id="status-of-api">未取得</p>
        <p id="linebotMessage">
        </p>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script crossorigin="anonymous">
        const endpoint = "https://script.google.com/macros/s/AKfycbzGyAW2WozUCj5fT1V2KImUFXAoK3LbS1IaxFv-BITterRYzT7oygY2AkKJ6aZYKQMq/exec"
        function inputToGoogleAPI() {
            // const inputvalue = document.getElementById('inputText').value;
            // alert(inputvalue);
            // return;
            document.getElementById('status-of-api').textContent = "データ取得中";
            $.ajax({
                type: 'GET',
                url: endpoint,
                dataType: 'jsonp',
                // dataType: 'json',
                data: {
                    text: 'Hi,There!'
                    // text: inputvalue
                }
            })
                .done(function (out) {
                    //  alert(out.message);
                    let message = out.message;
                    // これだと先頭のみ置き換え
                    // message = message.replace('\r\n','<br>');
                    // message = message.replace('\n','<br>');
                    // 正規表現ですべて置き換え
                    message = message.replace(/\r\n/g, '<br>');
                    message = message.replace(/\n/g, '<br>');
                    document.getElementById('linebotMessage').innerHTML = message;

                    // データ取得の結果
                    let todayDate = new Date();
                    let strDate = "";
                    strDate += `${todayDate.getFullYear()}/${todayDate.getMonth() + 1}/${todayDate.getDay()}`;
                    strDate += " ";
                    strDate += `${todayDate.getHours()}:${todayDate.getMinutes()}:${todayDate.getMinutes()}`;
                    document.getElementById('status-of-api').textContent = `データ取得完了:${strDate}`;
                })
                .fail(function (err) {
                    document.getElementById('status-of-api').textContent = `エラーが起きました:${err}`;
                    // alert("エラーが起きました");
                })
                .always(function () {
                    console.log("Ajax処理終了");
                });
        }

        function inputToGoogleAPI_Old() {
            // const inputvalue = document.getElementById('inputText').value;
            // alert(inputvalue);
            // return;
            document.getElementById('status-of-api').textContent = "データ取得中";
            $.ajax({
                type: 'GET',
                url: endpoint,
                dataType: 'jsonp',
                // dataType: 'json',
                data: {
                    text: 'Hi,There!'
                    // text: inputvalue
                },
                success: out => {
                    //  alert(out.message);
                    let message = out.message;
                    document.getElementById('linebotMessage').textContent = message;
                    linebotMessage
                    // データ取得の結果
                    let todayDate = new Date();
                    let strDate = "";
                    strDate += `${todayDate.getFullYear()}/${todayDate.getMonth() + 1}/${todayDate.getDay()}`;
                    strDate += " ";
                    strDate += `${todayDate.getHours()}:${todayDate.getMinutes()}:${todayDate.getMinutes()}`;
                    document.getElementById('status-of-api').textContent = `データ取得完了:${strDate}`;
                }
            });
        }
        function getImage() {
            const messageId = "14981908555399";
            let imgendpoint = `https://api-data.line.me/v2/bot/message/${messageId}/content`;
            $.ajax({
                type: 'GET',
                url: imgendpoint,
                // dataType: 'jsonp',
                // dataType: 'json',
                data: {
                    Authorization: 'Bearer' + 'zRlYj3Yy5XfdFWyPLZpwgwdmKDv3kmnFCNHgapyH827BCRCd+JMwB9gkOSzKcMvhLR5ltFYTII1lO/TJniYpjqXHsipYDz3zjAEKKaWKtTkVmCnHPzRzRd3qw/xBE5miyfnv8qGRkBc//aDEMsJH4gdB04t89/1O/w1cDnyilFU='
                    // text: inputvalue
                }
            })
                .done(function (out) {
                    //  alert(out.message);
                    let message = out.message;
                    // これだと先頭のみ置き換え
                    // message = message.replace('\r\n','<br>');
                    // message = message.replace('\n','<br>');
                    // 正規表現ですべて置き換え
                    message = message.replace(/\r\n/g, '<br>');
                    message = message.replace(/\n/g, '<br>');
                    document.getElementById('linebotMessage').innerHTML = message;

                    // データ取得の結果
                    let todayDate = new Date();
                    let strDate = "";
                    strDate += `${todayDate.getFullYear()}/${todayDate.getMonth() + 1}/${todayDate.getDay()}`;
                    strDate += " ";
                    strDate += `${todayDate.getHours()}:${todayDate.getMinutes()}:${todayDate.getMinutes()}`;
                    document.getElementById('status-of-api').textContent = `データ取得完了:${strDate}`;
                })
                .fail(function (err) {
                    document.getElementById('status-of-api').textContent = `エラーが起きました:${err}`;
                    // alert("エラーが起きました");
                })
                .always(function () {
                    console.log("Ajax処理終了");
                });
        }

        window.onload = () => {
            inputToGoogleAPI();
        };
        const countUp = () => {
            inputToGoogleAPI();
            // console.log(count++);
            // document.getElementById('status-of-counter').textContent = count;
        }
        setInterval(countUp, 300000);
    </script>
</body>

</html>