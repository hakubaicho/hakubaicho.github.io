<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title>TSV</title>
  </head>
  <body>
    <form name="myform">
        <input name="myfile" type="file" />
        <textarea name="output" cols="80" rows="10"></textarea>
				<textarea name="output-tsv"></textarea>
		<button onclick="getCSV()">CSVread</button>
    </form>

    <script>
			//Form要素を取得する
    	var form = document.forms.myform;
    
    	//ファイルが読み込まれた時の処理
    	form.myfile.addEventListener('change', function(e) {
      
        //ここにファイル取得処理を書く
        //--------------------------------------
        //読み込んだファイル情報を取得
        //--------------------------------------
        var resultinfo = e.target.files;
        console.log( resultinfo );
        //--------------------------------------
        //--------------------------------------
        var resultfile = e.target.files[0];
				//FileReaderのインスタンスを作成する
				var reader = new FileReader();
  
				//読み込んだファイルの中身を取得する
				reader.readAsText( resultfile );

				//ファイルの中身を取得後に処理を行う
				reader.addEventListener( 'load', function() {
	    	  //ファイルの中身をtextarea内に表示する
  	    	form.output.textContent = reader.result; 
					
					//CSVを1行ずつ読み込む
					const lines = reader.result.split('\n');
			    console.log(lines);
					for(let i = 0; i < lines.length; i++)
					{
						const columns = lines[i].split('\t');
						console.log(columns);
					}
  			})

    	})
    
			function getCSV() {
				const filepath = "http://hakubaicho.github.io/onepage_forma/data/items.txt";
				let req = new XMLHttpRequest(); // HTTPでファイルを読み込むためのXMLHttpRrequestオブジェクトを生成
				req.open("get", filepath, true); // アクセスするファイルを指定
				req.send(null); // HTTPリクエストの発行
	
				// レスポンスが返ってきたらconvertCSVtoArray()を呼ぶ	
				req.onload = function(){
					convertTSVtoArray(req.responseText); // 渡されるのは読み込んだCSVデータ
					console.log('req onload');
    		}
			}
			// 読み込んだCSVデータを二次元配列に変換する関数convertCSVtoArray()の定義
			function convertTSVtoArray(str){ // 読み込んだCSVデータが文字列として渡される
				console.log('convertTSVtoArray' + ` = ${str}`);
				let result = []; // 最終的な二次元配列を入れるための配列
				let tmp = str.split("\n"); // 改行を区切り文字として行を要素とした配列を生成
			
				// 各行ごとにカンマで区切った文字列を要素とした二次元配列を生成
				for(var i=0;i<tmp.length;++i){
					result[i] = tmp[i].split('\t');
				}
			
				let value = '';
				for(let i=0;i<tmp.length;i++)
				{
					console.log(result[i]);
					value += '[${i}] ${tmp[i]}';
				}
				document.getElementById('output-tsv').textContent = value;
				alert(result[1][2]); // 300yen
			}
		</script>
  </body>
</html>